<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>OSCORE profile of the Authentication and Authorization for Constrained Environments Framework</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 550px);
    width: 300px;
    z-index: 1;
  }
  #rfc\.toc {
    top: 55px;
    overflow: auto;
    overscroll-behavior: contain;
  }
  ul.toc, #rfc\.toc {
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>ul.toc {
    top: 140px;
  }

  body {
    padding-right: 350px;
  }
}

body {
  font: 16px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 36px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p, #rfc\.abstract p {
  font-size: 18px;
  line-height: 27px%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2 Client to Resource Server">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Signaling the use of OSCORE">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Key establishment for OSCORE">
<link href="#rfc.section.3" rel="Chapter" title="3 Client to Authorization Server">
<link href="#rfc.section.4" rel="Chapter" title="4 Resource Server to Authorization Server">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Privacy Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Profile Requirements">
<link href="#rfc.appendix.B" rel="Chapter" title="B Using the pop-key with EDHOC (EDHOC+OSCORE)">
<link href="#rfc.appendix.B.1" rel="Chapter" title="B.1 Using Asymmetric Keys">
<link href="#rfc.appendix.B.2" rel="Chapter" title="B.2 Using Symmetric Keys">
<link href="#rfc.appendix.B.3" rel="Chapter" title="B.3 Processing">
<link href="#rfc.acknowledgments" rel="Chapter">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.9.6 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Seitz, L., Palombini, F., and M. Gunnarsson" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-ace-oscore-profile-01" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-01" />
  <meta name="dct.abstract" content="This memo specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework.  It utilizes Object Security for Constrained RESTful Environments (OSCORE) to provide communication security, server authentication, and proof-of-possession for a key owned by the client and bound to an OAuth 2.0 access token.  " />
  <meta name="description" content="This memo specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework.  It utilizes Object Security for Constrained RESTful Environments (OSCORE) to provide communication security, server authentication, and proof-of-possession for a key owned by the client and bound to an OAuth 2.0 access token.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">ACE Working Group</td>
<td class="right">L. Seitz</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">RISE SICS AB</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">F. Palombini</td>
</tr>
<tr>
<td class="left">Expires: September 2, 2018</td>
<td class="right">Ericsson AB</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">M. Gunnarsson</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">RISE SICS AB</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">March 1, 2018</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">OSCORE profile of the Authentication and Authorization for Constrained Environments Framework<br />
  <span class="filename">draft-ietf-ace-oscore-profile-01</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This memo specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework.  It utilizes Object Security for Constrained RESTful Environments (OSCORE) to provide communication security, server authentication, and proof-of-possession for a key owned by the client and bound to an OAuth 2.0 access token.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 2, 2018.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Terminology</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Client to Resource Server</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Signaling the use of OSCORE</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Key establishment for OSCORE</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Client to Authorization Server</a>
</li>
<li>4.   <a href="#rfc.section.4">Resource Server to Authorization Server</a>
</li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Privacy Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<ul><li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Profile Requirements</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.B">Using the pop-key with EDHOC (EDHOC+OSCORE)</a>
</li>
<ul><li>B.1.   <a href="#rfc.appendix.B.1">Using Asymmetric Keys</a>
</li>
<li>B.2.   <a href="#rfc.appendix.B.2">Using Symmetric Keys</a>
</li>
<li>B.3.   <a href="#rfc.appendix.B.3">Processing</a>
</li>
</ul><li><a href="#rfc.acknowledgments">Acknowledgments</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This memo specifies a profile of the ACE framework <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  In this profile, a client and a resource server use CoAP <a href="#RFC7252" class="xref">[RFC7252]</a> to communicate.  The client uses an access token, bound to a key (the proof-of-possession key) to authorize its access to the resource server.  In order to provide communication security, proof of possession, and server authentication they use Object Security for Constrained RESTful Environments (OSCORE) <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  Optionally the client and the resource server may also use CoAP and OSCORE to communicate with the authorization server.  </p>
<p id="rfc.section.1.p.2">OSCORE specifies how to use CBOR Object Signing and Encryption (COSE) <a href="#RFC8152" class="xref">[RFC8152]</a> to secure CoAP messages.  In order to provide replay and reordering protection OSCORE also introduces sequence numbers that are used together with COSE.  </p>
<p id="rfc.section.1.p.3">Note that OSCORE can be used to secure CoAP messages, as well as HTTP and combinations of HTTP and CoAP; a profile of ACE similar to the one described in this document, with the difference of using HTTP instead of CoAP as communication protocol, could be specified analogously to this one.  </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119" class="xref">[RFC2119]</a>.  These words may also appear in this document in lowercase, absent their normative meanings.  </p>
<p id="rfc.section.1.1.p.2">Certain security-related terms such as "authentication", "authorization", "confidentiality", "(data) integrity", "message  authentication code", and "verify" are taken from <a href="#RFC4949" class="xref">[RFC4949]</a>.  </p>
<p id="rfc.section.1.1.p.3">Since we describe exchanges as RESTful protocol interactions HTTP <a href="#RFC7231" class="xref">[RFC7231]</a> offers useful terminology.  </p>
<p id="rfc.section.1.1.p.4">Terminology for entities in the architecture is defined in OAuth 2.0 <a href="#RFC6749" class="xref">[RFC6749]</a> and <a href="#I-D.ietf-ace-actors" class="xref">[I-D.ietf-ace-actors]</a>, such as client (C), resource server (RS), and authorization server (AS). It is assumed in this document that a given resource on a specific RS is associated to a unique AS.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Client to Resource Server</h1>
<p id="rfc.section.2.p.1">The use of OSCORE for arbitrary CoAP messages is specified in <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  This section defines the specific uses and their purpose for securing the communication between a client and a resource server, and the parameters needed to negotiate the use of this profile with the token resource at the authorization server as specified in section 5.5 of the ACE framework <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Signaling the use of OSCORE</h1>
<p id="rfc.section.2.1.p.1">A client requests a token at an AS via the /token resource.  This follows the message formats specified in section 5.5.1 of the ACE framework <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<p id="rfc.section.2.1.p.2">The AS responding to a successful access token request as defined in section 5.5.2 of the ACE framework can signal that the use of OSCORE is REQUIRED for a specific access token by including the "profile" parameter with the value "coap_oscore" in the access token response.  This means that the client MUST use OSCORE towards all resource servers for which this access token is valid, and follow <a href="#oscore-only" class="xref">Section 2.2</a> to derive the security context to run OSCORE.  </p>
<p id="rfc.section.2.1.p.3">The error response procedures defined in section 5.5.3 of the ACE framework are unchanged by this profile.  </p>
<p id="rfc.section.2.1.p.4">Note the the client and the authorization server MAY OPTIONALLY use OSCORE to protect the interaction via the /token resource. See <a href="#c-as" class="xref">Section 3</a> for details.  </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#oscore-only" id="oscore-only">Key establishment for OSCORE</a>
</h1>
<p id="rfc.section.2.2.p.1">Section 3.2 of OSCORE <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a> defines how to derive a security context based on a shared master secret and a set of other parameters, established between client and server.  The proof-of-possession key (pop-key) provisioned from the AS MAY, in case of pre-shared keys, be used directly as master secret in OSCORE.  </p>
<p id="rfc.section.2.2.p.2">If OSCORE is used directly with the symmetric pop-key as master secret, then the AS MUST provision the following data, in response to the access token request: </p>
<p></p>

<ul>
<li>a master secret</li>
<li>the sender identifier</li>
<li>the recipient identifier</li>
</ul>

<p> </p>
<p id="rfc.section.2.2.p.4">Additionally, the AS MAY provision the following data, in the same response.  In case these parameters are omitted, the default values are used as described in section 3.2 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  </p>
<p></p>

<ul>
<li>an AEAD algorithm</li>
<li>a KDF algorithm</li>
<li>a salt</li>
<li>a replay window type and size</li>
</ul>

<p> </p>
<p id="rfc.section.2.2.p.6">The master secret MUST be communicated as COSE_Key in the 'cnf' parameter of the access token response as defined in section 5.5.4.5 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  The AEAD algorithm MAY be included as the 'alg' parameter in the COSE_Key; the KDF algorithm MAY be included as the 'kdf' parameter of the COSE_Key and the salt MAY be included as the 'slt' parameter of the COSE_Key as defined in table 1.  </p>
<p id="rfc.section.2.2.p.7">The same parameters MUST be included as metadata of the access token; if the token is a CWT <a href="#I-D.ietf-ace-cbor-web-token" class="xref">[I-D.ietf-ace-cbor-web-token]</a>, the same COSE_Key structure MUST be placed in the 'cnf' claim of this token.  If a CWT is used, it MUST be encrypted in order to protect the key from eavesdroppers, when the token is initially transferred from the client to the RS, as this communication happens over an unprotected channel.</p>
<p id="rfc.section.2.2.p.8">The AS MUST also assign identifiers to both client and RS, which are then used as Sender ID and Recipient ID in the OSCORE context as described in section 3.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  These identifiers MUST be unique in the set of all clients and RS identifiers for a certain AS.  Moreover, these MUST be included in the COSE_Key as header parameters, as defined in table 1.  </p>
<p id="rfc.section.2.2.p.9">We assume in this document that a resource is associated to one single AS, which makes it possible to assume unique identifiers for each client requesting a particular resource to a RS.  If this is not the case, collisions of identifiers may appear in the RS, in which case the RS needs to have a mechanism in place to disambiguate identifiers or mitigate their effect.  </p>
<p id="rfc.section.2.2.p.10">Note that C should set the Sender ID of its security context to the clientId value received and the Recipient ID to the serverId value, and RS should do the opposite.  </p>
<pre>
+----------+-------+--------------+------------+-------------------+
| name     | label | CBOR type    | registry   | description       |
+----------+-------+--------------+------------+-------------------+
| clientId | 10    | bstr         |            | Identifies the    |
|          |       |              |            | client in an      |
|          |       |              |            | OSCORE context    |
|          |       |              |            | using this key    |
|          |       |              |            |                   |
| serverId | 11    | bstr         |            | Identifies the    |
|          |       |              |            | server in an      |
|          |       |              |            | OSCORE context    |
|          |       |              |            | using this key    |
|          |       |              |            |                   |
| kdf      | 12    | bstr         |            | Identifies the    |
|          |       |              |            | KDF algorithm in  |
|          |       |              |            | an OSCORE context |
|          |       |              |            | using this key    |
|          |       |              |            |                   |
| slt      | 13    | bstr         |            | Identifies the    |
|          |       |              |            | master salt in    |
|          |       |              |            | an OSCORE context |
|          |       |              |            | using this key    |
+----------+-------+--------------+------------+-------------------+
    Table 1: Additional common header parameters for COSE_Key

</pre>
<p id="rfc.section.2.2.p.11">Figure 1 shows an example of such an AS response, in CBOR diagnostic notation without the tag and value abbreviations.  </p>
<pre>
    Header: Created (Code=2.01)
    Content-Type: "application/cose+cbor"
    Payload:
    {
      "access_token" : b64'SlAV32hkKG ...
       (remainder of access token omitted for brevity)',
      "profile" : "coap_oscore",
      "expires_in" : "3600",
      "cnf" : {
        "COSE_Key" : {
          "kty" : "Symmetric",
          "alg" : "AES-CCM-16-64-128",
          "clientId" : b64'qA',
          "serverId" : b64'Qg',
          "k" : b64'+a+Dg2jjU+eIiOFCa9lObw'
        }
      }
    }

    Figure 1: Example AS response with OSCORE parameters.
</pre>
<p id="rfc.section.2.2.p.12">Figure 2 shows an example CWT, containing the necessary OSCORE parameters in the 'cnf' claim, in CBOR diagnostic notation without tag and value abbreviations.  </p>
<pre>
  {
    "aud" : "tempSensorInLivingRoom",
    "iat" : "1360189224",
    "exp" : "1360289224",
    "scope" :  "temperature_g firmware_p",
    "cnf" : {
      "COSE_Key" : {
        "kty" : "Symmetric",
        "alg" : "AES-CCM-16-64-128",
        "clientId" : b64'Qg',
        "serverId" : b64'qA',
        "k" : b64'+a+Dg2jjU+eIiOFCa9lObw' 
    }
  }

     Figure 2: Example CWT with OSCORE parameters.
</pre>
<p id="rfc.section.2.2.p.13">Note that the proof-of-possession required to bind the access token to the client is implicitly performed by generating the shared OSCORE context using the pop-key as master secret, both on the client and RS side.  An attacker using a stolen token will not be able to generate a valid OSCORE context and thus not be able to prove possession of the pop-key.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#c-as" id="c-as">Client to Authorization Server</a>
</h1>
<p id="rfc.section.3.p.1">As specified in the ACE framework section 5.5 <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>, the Client and AS can also use CoAP instead of HTTP to communicate via the token resource.  This section specifies how to use OSCORE between Client and AS together with CoAP.  The use of OSCORE for this communication is OPTIONAL in this profile, other security protocols (such as DTLS) MAY be used instead.  </p>
<p id="rfc.section.3.p.2">The client and the AS are expected to have pre-established security contexts in place.  How these security contexts are established is out of scope for this profile. Furthermore the client and the AS communicate using OSCORE (<a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>) through the introspection resource as specified in section 5.6 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Resource Server to Authorization Server</h1>
<p id="rfc.section.4.p.1">As specified in the ACE framework section 5.6 <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>, the RS and AS can also use CoAP instead of HTTP to communicate via the introspection resource.  This section specifies how to use OSCORE between RS and AS.  The use of OSCORE for this communication is OPTIONAL in this profile, other security protocols (such as DTLS) MAY be used instead.  </p>
<p id="rfc.section.4.p.2">The RS and the AS are expected to have pre-established security contexts in place.  How these security contexts are established is out of scope for this profile.  Furthermore the RS and the AS communicate using OSCORE (<a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>) through the introspection resource as specified in section 5.6 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Security Considerations</h1>
<p id="rfc.section.5.p.1">This document specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  Thus the general security considerations from the framework also apply to this profile.</p>
<p id="rfc.section.5.p.2">Furthermore the general security considerations of OSCORE <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a> also apply to this specific use of the OSCORE protocol.</p>
<p id="rfc.section.5.p.3">Since OSCORE is designed to secure point-to-point communication, providing a secure binding between the request and the response(s).  Thus the basic OSCORE protocol is not intended for use in point-to-multipoint communication (e.g. multicast, publish-subscribe).  Implementers of this profile should make sure that their usecase corresponds to the expected use of OSCORE, to prevent weakening the security assurances provided by OSCORE.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Privacy Considerations</h1>
<p id="rfc.section.6.p.1">TBD.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a>  IANA Considerations </h1>
<p id="rfc.section.7.p.1">Note to RFC Editor: Please replace all occurrences of "[[this specification]]" with the RFC number of this specification and delete this paragraph.</p>
<p id="rfc.section.7.p.2">The following registration is done for the ACE OAuth Profile Registry following the procedure specified in section 8.6 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>:</p>
<p></p>

<ul>
<li>Profile name: coap_oscore</li>
<li>Profile Description: Profile for using OSCORE to secure communication between constrained nodes using the Authentication and Authorization for Constrained Environments framework.</li>
<li>Profile ID: 2</li>
<li>Change Controller: IESG</li>
<li>Specification Document(s): [[this specification]]</li>
</ul>
<p id="rfc.section.7.p.4">The following registrations are done for the COSE Header Parameter Registry specified in section 16.2 of <a href="#RFC8152" class="xref">[RFC8152]</a>:</p>
<p></p>

<ul>
<li>Name: clientId</li>
<li>Label: 10</li>
<li>Value Type: bstr</li>
<li>Value Registry: N/A</li>
<li>Description: Identifies the client of an OSCORE context in the header of a COSE_Key used as master secret</li>
<li>Reference: [[this specification]]</li>
</ul>
<p></p>

<ul>
<li>Name: serverId</li>
<li>Label: 11</li>
<li>Value Type: bstr</li>
<li>Value Registry: N/A</li>
<li>Description: Identifies the server of an OSCORE context in the header of a COSE_Key used as master secret</li>
<li>Reference: [[this specification]]</li>
</ul>
<p></p>

<ul>
<li>Name: kdf</li>
<li>Label: 12</li>
<li>Value Type: bstr</li>
<li>Value Registry: COSE Algorithms registry</li>
<li>Description: Identifies the KDF algorithm of an OSCORE context in the header of a COSE_Key used as master secret</li>
<li>Reference: [[this specification]]</li>
</ul>
<p></p>

<ul>
<li>Name: slt</li>
<li>Label: 13</li>
<li>Value Type: bstr</li>
<li>Value Registry: N/A</li>
<li>Description: Identifies the master salt of an OSCORE context in the header of a COSE_Key used as master secret.</li>
<li>Reference: [[this specification]]</li>
</ul>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-ace-cbor-web-token">[I-D.ietf-ace-cbor-web-token]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Wahlstroem, E.</a>, <a>Erdtman, S.</a> and <a>H. Tschofenig</a>, "<a href="https://tools.ietf.org/html/draft-ietf-ace-cbor-web-token-12">CBOR Web Token (CWT)</a>", Internet-Draft draft-ietf-ace-cbor-web-token-12, February 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</b></td>
<td class="top">
<a>Seitz, L.</a>, <a>Selander, G.</a>, <a>Wahlstroem, E.</a>, <a>Erdtman, S.</a> and <a>H. Tschofenig</a>, "<a href="https://tools.ietf.org/html/draft-ietf-ace-oauth-authz-10">Authentication and Authorization for Constrained Environments (ACE)</a>", Internet-Draft draft-ietf-ace-oauth-authz-10, February 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-core-object-security">[I-D.ietf-core-object-security]</b></td>
<td class="top">
<a>Selander, G.</a>, <a>Mattsson, J.</a>, <a>Palombini, F.</a> and <a>L. Seitz</a>, "<a href="https://tools.ietf.org/html/draft-ietf-core-object-security-08">Object Security for Constrained RESTful Environments (OSCORE)</a>", Internet-Draft draft-ietf-core-object-security-08, January 2018.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7252">[RFC7252]</b></td>
<td class="top">
<a>Shelby, Z.</a>, <a>Hartke, K.</a> and <a>C. Bormann</a>, "<a href="https://tools.ietf.org/html/rfc7252">The Constrained Application Protocol (CoAP)</a>", RFC 7252, DOI 10.17487/RFC7252, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8152">[RFC8152]</b></td>
<td class="top">
<a>Schaad, J.</a>, "<a href="https://tools.ietf.org/html/rfc8152">CBOR Object Signing and Encryption (COSE)</a>", RFC 8152, DOI 10.17487/RFC8152, July 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.gerdes-ace-dcaf-authorize">[I-D.gerdes-ace-dcaf-authorize]</b></td>
<td class="top">
<a>Gerdes, S.</a>, <a>Bergmann, O.</a> and <a>C. Bormann</a>, "<a href="https://tools.ietf.org/html/draft-gerdes-ace-dcaf-authorize-04">Delegated CoAP Authentication and Authorization Framework (DCAF)</a>", Internet-Draft draft-gerdes-ace-dcaf-authorize-04, October 2015.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-ace-actors">[I-D.ietf-ace-actors]</b></td>
<td class="top">
<a>Gerdes, S.</a>, <a>Seitz, L.</a>, <a>Selander, G.</a> and <a>C. Bormann</a>, "<a href="https://tools.ietf.org/html/draft-ietf-ace-actors-06">An architecture for authorization in constrained environments</a>", Internet-Draft draft-ietf-ace-actors-06, November 2017.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.selander-ace-cose-ecdhe">[I-D.selander-ace-cose-ecdhe]</b></td>
<td class="top">
<a>Selander, G.</a>, <a>Mattsson, J.</a> and <a>F. Palombini</a>, "<a href="https://tools.ietf.org/html/draft-selander-ace-cose-ecdhe-07">Ephemeral Diffie-Hellman Over COSE (EDHOC)</a>", Internet-Draft draft-selander-ace-cose-ecdhe-07, July 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4949">[RFC4949]</b></td>
<td class="top">
<a>Shirey, R.</a>, "<a href="https://tools.ietf.org/html/rfc4949">Internet Security Glossary, Version 2</a>", FYI 36, RFC 4949, DOI 10.17487/RFC4949, August 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6749">[RFC6749]</b></td>
<td class="top">
<a>Hardt, D.</a>, "<a href="https://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>", RFC 6749, DOI 10.17487/RFC6749, October 2012.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7049">[RFC7049]</b></td>
<td class="top">
<a>Bormann, C.</a> and <a>P. Hoffman</a>, "<a href="https://tools.ietf.org/html/rfc7049">Concise Binary Object Representation (CBOR)</a>", RFC 7049, DOI 10.17487/RFC7049, October 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7231">[RFC7231]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>", RFC 7231, DOI 10.17487/RFC7231, June 2014.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> Profile Requirements</h1>
<p id="rfc.section.A.p.1">This section lists the specifications on this profile based on the requirements on the framework, as requested in Appendix C. of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<p></p>

<ul>
<li>(Optional) discovery process of how the client finds the right AS for an RS it wants to send a request to: Not specified </li>
<li>communication protocol the client and the RS must use: CoAP </li>
<li>security protocol the client and RS must use: OSCORE </li>
<li>how the client and the RS mutually authenticate: Implicitly by possession of a common OSCORE security context </li>
<li>Content-format of the protocol messages: "application/cose+cbor" </li>
<li>proof-of-possession protocol(s) and how to select one; which key types (e.g. symmetric/asymmetric) supported: OSCORE algorithms; pre-established symmetric keys </li>
<li>profile identifier: coap_oscore </li>
<li>(Optional) how the RS talks to the AS for introspection: HTTP/CoAP (+ TLS/DTLS/OSCORE) </li>
<li>how the client talks to the AS for requesting a token: HTTP/CoAP (+ TLS/DTLS/OSCORE) </li>
<li>how/if the /authz-info endpoint is protected: Security protocol above </li>
<li>(Optional)other methods of token transport than the /authz-info endpoint: no </li>
</ul>

<p> </p>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#oscore-edhoc" id="oscore-edhoc">Using the pop-key with EDHOC (EDHOC+OSCORE)</a>
</h1>
<p id="rfc.section.B.p.1">EDHOC specifies an authenticated Diffie-Hellman protocol that allows two parties to use CBOR <a href="#RFC7049" class="xref">[RFC7049]</a> and COSE in order to establish a shared secret key with perfect forward secrecy.  The use of Ephemeral Diffie-Hellman Over COSE (EDHOC) <a href="#I-D.selander-ace-cose-ecdhe" class="xref">[I-D.selander-ace-cose-ecdhe]</a> in this profile in addition to OSCORE, provides perfect forward secrecy (PFS) and the initial proof-of-possession, which ties the proof-of-possession key to an OSCORE security context.  </p>
<p id="rfc.section.B.p.2">If EDHOC is used together with OSCORE, and the pop-key (symmetric or asymmetric) is used to authenticate the messages in EDHOC, then the AS MUST provision the following data, in response to the access token request: </p>
<p></p>

<ul>
<li>a symmetric or public key (associated to the RS)</li>
<li>a key identifier;</li>
</ul>

<p> </p>
<p id="rfc.section.B.p.4">How these parameters are communicated depends on the type of key (asymmetric or symmetric).  Moreover, the AS MUST signal the use of OSCORE + EDHOC with the 'profile' parameter set to "coap_oscore_edhoc" and follow  <a href="#oscore-edhoc" class="xref">Appendix B</a> to derive the security context to run OSCORE.  </p>
<p id="rfc.section.B.p.5">Note that in the case described in this section, the 'expires_in' parameter, defined in section 4.2.2. of <a href="#RFC6749" class="xref">[RFC6749]</a> defines the lifetime in seconds of both the access token and the shared secret. After expiration, C MUST acquire a new access token from the AS, and run EDHOC again, as specified in this section </p>
<h1 id="rfc.appendix.B.1">
<a href="#rfc.appendix.B.1">B.1.</a> <a href="#edhoc-asym" id="edhoc-asym">Using Asymmetric Keys</a>
</h1>
<p id="rfc.section.B.1.p.1">In case of an asymmetric key, C MUST communicate its own asymmetric key to the AS in the 'cnf' parameter of the access token request, as specified in section 5.5.1 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>; the AS MUST communicate the RS's public key to C in the response, in the 'rs_cnf' parameter, as specified in section 5.5.1 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>. Note that the RS's public key MUST include a 'kid' parameter, and that the value of the 'kid' MUST be included in the access token, to let the RS know which of its public keys C used.  If the access token is a CWT <a href="#I-D.ietf-ace-cbor-web-token" class="xref">[I-D.ietf-ace-cbor-web-token]</a>, the key identifier MUST be placed directly in the 'cnf' structure (if the key is only referenced).  </p>
<p id="rfc.section.B.1.p.2">Figure 3 shows an example of such a request in CBOR diagnostic notation without tag and value abbreviations.  </p>
<pre>
Header: POST (Code=0.02)
Uri-Host: "server.example.com"
Uri-Path: "token"
Content-Type: "application/cose+cbor"
Payload:
{
 "grant_type" : "client_credentials",
 "cnf" : {
   "COSE_Key" : {
     "kid" : "client_key"
     "kty" : "EC",
     "crv" : "P-256",
     "x" : b64'usWxHK2PmfnHKwXPS54m0kTcGJ90UiglWiGahtagnv8',
     "y" : b64'IBOL+C3BttVivg+lSreASjpkttcsz+1rb7btKLv8EX4'
   }
 }
}

Figure 3: Example access token request (OSCORE+EDHOC, asymmetric).
</pre>
<p id="rfc.section.B.1.p.3">Figure 4 shows an example of a corresponding response in CBOR diagnostic notation without tag and value abbreviations.  </p>
<pre>
  Header: Created (Code=2.01)
  Content-Type: "application/cose+cbor"
  Payload:
  {
    "access_token" : b64'SlAV32hkKG ...
     (contains "kid" : "client_key")',
    "profile" : "coap_oscore_edhoc",
    "expires_in" : "3600",
    "cnf" : {
      "COSE_Key" : {
        "kid" : "server_key"
        "kty" : "EC",
        "crv" : "P-256",
        "x" : b64'cGJ90UiglWiGahtagnv8usWxHK2PmfnHKwXPS54m0kT',
        "y" : b64'reASjpkttcsz+1rb7btKLv8EX4IBOL+C3BttVivg+lS'
     }
    }
  }

Figure 4: Example AS response (EDHOC+OSCORE, asymmetric).
</pre>
<h1 id="rfc.appendix.B.2">
<a href="#rfc.appendix.B.2">B.2.</a> <a href="#edhoc-sym" id="edhoc-sym">Using Symmetric Keys</a>
</h1>
<p id="rfc.section.B.2.p.1">In the case of a symmetric key, the AS MUST communicate the key to the client in the 'cnf' parameter of the access token response, as specified in section 5.5.2. of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.   AS MUST also select a key identifier, that MUST be included as the 'kid' parameter either directly in the 'cnf' structure, as in figure 4 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>, or as the 'kid' parameter of the COSE_key, as in figure 6 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<p id="rfc.section.B.2.p.2">Figure 5 shows an example of the necessary parameters in the AS response to the access token request when EDHOC is used.  The example uses CBOR  diagnostic notation without tag and value abbreviations.  </p>
<pre>
  Header: Created (Code=2.01)
  Content-Type: "application/cose+cbor"
  Payload:
  {
    "access_token" : b64'SlAV32hkKG ...
     (remainder of access token omitted for brevity)',
    "profile" : "coap_oscore_edhoc",
    "expires_in" : "3600",
    "cnf" : {
      "COSE_Key" : {
        "kty" : "Symmetric",
        "kid" : b64'5tOS+h42dkw',
        "k" : b64'+a+Dg2jjU+eIiOFCa9lObw'
      }
    }
  }

Figure 5: Example AS response (EDHOC+OSCORE, symmetric).
</pre>
<p id="rfc.section.B.2.p.3">In both cases, the AS MUST also include the same key identifier as 'kid' parameter in the access token metadata. If the access token is a CWT <a href="#I-D.ietf-ace-cbor-web-token" class="xref">[I-D.ietf-ace-cbor-web-token]</a>, the key identifier MUST be placed inside the 'cnf' claim as 'kid' parameter of the COSE_Key or directly in the 'cnf' structure (if the key is only referenced).  </p>
<p id="rfc.section.B.2.p.4">Figure 6 shows an example CWT containing the necessary EDHOC+OSCORE parameters in the 'cnf' claim, in CBOR diagnostic notation without tag and value abbreviations.  </p>
<pre>
{
  "aud" : "tempSensorInLivingRoom",
  "iat" : "1360189224",
  "exp" : "1360289224",
  "scope" :  "temperature_g firmware_p",
  "cnf" : {
    "COSE_Key" : {
      "kty" : "Symmetric",
      "kid" : b64'5tOS+h42dkw',
      "k" : b64'+a+Dg2jjU+eIiOFCa9lObw' 
  }
}

  Figure 6: Example CWT with EDHOC+OSCORE, symmetric case.
</pre>
<p id="rfc.section.B.2.p.5">All other parameters defining OSCORE security context are derived from EDHOC message exchange, including the master secret (see Appendix C.2 of <a href="#I-D.selander-ace-cose-ecdhe" class="xref">[I-D.selander-ace-cose-ecdhe]</a>).  </p>
<h1 id="rfc.appendix.B.3">
<a href="#rfc.appendix.B.3">B.3.</a> <a href="#edhoc-proc" id="edhoc-proc">Processing</a>
</h1>
<p id="rfc.section.B.3.p.1">To provide forward secrecy and mutual authentication in the case of pre-shared keys, pre-established raw public keys or with X.509 certificates it is RECOMMENDED to use EDHOC <a href="#I-D.selander-ace-cose-ecdhe" class="xref">[I-D.selander-ace-cose-ecdhe]</a> to generate the keying material.  EDHOC MUST be used as defined in Appendix C of <a href="#I-D.selander-ace-cose-ecdhe" class="xref">[I-D.selander-ace-cose-ecdhe]</a>, with the following additions and modifications.  </p>
<p id="rfc.section.B.3.p.2">The first EDHOC message is sent after the access token is posted to the /authz-info resource of the RS as specified in section 5.7.1 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>. Then the EDHOC message_1 is sent and the EDHOC protocol is initiated <a href="#I-D.selander-ace-cose-ecdhe" class="xref">[I-D.selander-ace-cose-ecdhe]</a>).  </p>
<p id="rfc.section.B.3.p.3">Before the RS continues with the EDHOC protocol and responds to this token submission request, additional verifications on the access token are done: the RS SHALL process the access token according to <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  If the token is valid then the RS continues processing EDHOC following Appendix C of <a href="#I-D.selander-ace-cose-ecdhe" class="xref">[I-D.selander-ace-cose-ecdhe]</a>, otherwise it discontinues EDHOC and responds with the error code as specified in <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<p></p>

<ul>
<li>In case the EDHOC verification fails, the RS MUST return an error response to the client with code 4.01 (Unauthorized).  </li>
<li>If RS has an access token for C but not for the resource that C has requested, RS MUST reject the request with a 4.03 (Forbidden).  </li>
<li>If RS has an access token for C but it does not cover the action C requested on the resource, RS MUST reject the request with a 4.05 (Method Not Allowed).  </li>
<li>If all verifications above succeeds, further communication between client and RS is protected with OSCORE, including the RS response to the OSCORE request.  </li>
</ul>

<p> </p>
<p id="rfc.section.B.3.p.5">In the case of EDHOC being used with symmetric keys, the protocol in section 5 of <a href="#I-D.selander-ace-cose-ecdhe" class="xref">[I-D.selander-ace-cose-ecdhe]</a> MUST be used.  If the key is asymmetric, the RS MUST also use an asymmetric key for authentication.  This key is known to the client through the access token response (see section 5.5.2 of the ACE framework).  In this case the protocol in section 4 of <a href="#I-D.selander-ace-cose-ecdhe" class="xref">[I-D.selander-ace-cose-ecdhe]</a> MUST be used.  </p>
<p id="rfc.section.B.3.p.6">Figure 7 illustrates the message exchanges for using OSCORE+EDHOC  (step C in figure 1 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>).  </p>
<pre>
                 Resource
        Client    Server
        |          |
        |          |
        +---------&gt;| Header: POST (Code=0.02)
        | POST     | Uri-Path:"authz-info"
        |          | Content-Type: application/cbor
        |          | Payload: access token
        |          |
        |          |
        +---------&gt;| Header: POST (Code=0.02)
        |   POST   | Uri-Path: "/.well-known/edhoc"
        |          | Content-Type: application/edhoc
        |          | Payload: EDHOC message_1
        |          |
        |&lt;---------+ Header: 2.04 Changed
        |   2.04   | Content-Type: application/edhoc
        |          | Payload: EDHOC message_2
        |          |
        +---------&gt;| Header: POST (Code=0.02)
        |   POST   | Uri-Path: "/.well-known/edhoc"
        |          | Content-Type: application/edhoc
        |          | Payload: EDHOC message_3
        |          |
        |&lt;---------+ Header: 2.04 Changed
        |   2.04   |
        |          |
 start of protected communication
        |          |
        +---------&gt;| CoAP request +
        |  OSCORE  | Object-Security option
        | request  | 
        |          |
        |&lt;---------+ CoAP response +
        |  OSCORE  | Object-Security option
        | response | 
        |          |  

Figure 7: Access token and key establishment with EDHOC
</pre>
<h1 id="rfc.acknowledgments"><a href="#rfc.acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.C.p.1">The authors wish to thank Jim Schaad, Goeran Selander and Marco Tiloca for the input on this memo.  The error responses specified in <a href="#edhoc-proc" class="xref">Appendix B.3</a> were originally specified by Gerdes et al. in <a href="#I-D.gerdes-ace-dcaf-authorize" class="xref">[I-D.gerdes-ace-dcaf-authorize]</a>.  </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ludwig Seitz</span> 
	  <span class="n hidden">
		<span class="family-name">Seitz</span>
	  </span>
	</span>
	<span class="org vcardline">RISE SICS AB</span>
	<span class="adr">
	  <span class="vcardline">Scheelevagen 17</span>

	  <span class="vcardline">
		<span class="locality">Lund</span>,  
		<span class="region"></span>
		<span class="code">22370</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ludwig.seitz@ri.se">ludwig.seitz@ri.se</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Francesca Palombini</span> 
	  <span class="n hidden">
		<span class="family-name">Palombini</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson AB</span>
	<span class="adr">
	  <span class="vcardline">Farogatan 6</span>

	  <span class="vcardline">
		<span class="locality">Kista</span>,  
		<span class="region"></span>
		<span class="code">SE-16480 Stockholm</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:francesca.palombini@ericsson.com">francesca.palombini@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Martin Gunnarsson</span> 
	  <span class="n hidden">
		<span class="family-name">Gunnarsson</span>
	  </span>
	</span>
	<span class="org vcardline">RISE SICS AB</span>
	<span class="adr">
	  <span class="vcardline">Scheelevagen 17</span>

	  <span class="vcardline">
		<span class="locality">Lund</span>,  
		<span class="region"></span>
		<span class="code">22370</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:martin.gunnarsson@ri.se">martin.gunnarsson@ri.se</a></span>

  </address>
</div>

</body>
</html>
